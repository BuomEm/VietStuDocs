# Set PHP Timezone to Vietnam (UTC+7)
php_value date.timezone "Asia/Ho_Chi_Minh"
php_value session.gc_maxlifetime 604800
php_value session.cookie_lifetime 604800

RewriteEngine On

# 1. Redirect .php to extensionless (Redirect public URL)
# For specific whitelisted root files
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/(dashboard|edit-document|error|history|index|login|logout|premium|privacy|profile|saved|search|signup|sitemap|terms|testapi|transaction-details|upload|user_profile|view)\.php [NC]
RewriteRule ^ /%1 [R=301,L]

# For tutors directory files
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/tutors/(apply|dashboard|profile_edit|request)\.php [NC]
RewriteRule ^ /tutors/%1 [R=301,L]

# 2. Rewrite extensionless to .php (Internal handling)
# For whitelisted root files
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(dashboard|edit-document|error|history|index|login|logout|premium|privacy|profile|saved|search|signup|sitemap|terms|testapi|transaction-details|upload|user_profile|view)$ $1.php [L]

# 2.1 API Folder Handling (Case-Insensitive & Extensionless)
# Handle /api/ or /API/ calls
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(api|API)/(.*)$ API/$2 [NC,PT]

# Handle extensionless files in API folder
RewriteCond %{REQUEST_URI} ^/(api|API)/ [NC]
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(api|API)/(.*)$ API/$2.php [NC,L]

# For Admin directory
RewriteCond %{REQUEST_URI} ^/admin/
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^admin/(.*)$ admin/$1.php [L]

# For Tutors directory
RewriteCond %{REQUEST_URI} ^/tutors/
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^tutors/(.*)$ tutors/$1.php [L]

# 3. Handle index.php redirect (Hide index.php)
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s(.*)/index\.php [NC]
RewriteRule ^ %1/ [R=301,L]

# Error Pages
ErrorDocument 400 /error.php?code=400
ErrorDocument 401 /error.php?code=401
ErrorDocument 403 /error.php?code=403
ErrorDocument 404 /error.php?code=404
ErrorDocument 500 /error.php?code=500


# Protect Sensitive Files
<FilesMatch "^(\.env|\.git|composer\.lock|composer\.json)">
    Order allow,deny
    Deny from all
</FilesMatch>

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault "access plus 1 month"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# Block access to protected directories
<IfModule mod_rewrite.c>
    RewriteRule ^includes/ - [F,L]
    RewriteRule ^config/ - [F,L]
    RewriteRule ^database/ - [F,L]
    RewriteRule ^AAA/ - [F,L]
</IfModule>
